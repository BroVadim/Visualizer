<html>

<head>
  <link rel="stylesheet" href="leaflet/leaflet.css" />
  <script src="leaflet/leaflet.js"></script>
  <script src="map.js"></script>
  <style>
    #map {width: 1200px; height: 800px; }
  </style>
</head>

<body>
  <div id="map"></div>

  <script type='text/javascript'>
  //Определяем карту, координаты центра и начальный масштаб
  var map = L.map('map').setView([45.035470, 38.975313], 13);

  map.on(
    'popupopen', function(e)
      {
        var latLngArray = e.popup.getLatLng(); //определяем долготу и широту
        //alert(latLngArray)
        var circle = L.circle(latLngArray, {
          color: 'red',
          fillColor: '#f03',
          fillOpacity: 0.5,
          radius: 1000
        }).addTo(map);

        regexp = '(?<=\<strong\>).*?(?=\<\/strong\>)' //регулярка для удаления тега из заголовка popup
        popup_content = String(e.popup._source._popup._content) //данные о popup, на который нажали
        let matcher = popup_content.match(regexp);
        neighbors = objects[matcher]["neighbors"]
      }
  );

  //Добавляем на нашу карту слой OpenStreetMap
  L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a rel="nofollow" href="http://osm.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);

  var searchedObjects = []
  for (let key of Object.keys(objects)) {
    if (objects[key]["neighbors"].length!=0)
    {
      latitude = objects[key]["latitude"];
      longtitude = objects[key]["longtitude"];
      square = String(objects[key]["square"]);
      description="<strong>"+key+"</strong><p>"+square+" м<sup>2</sup></p>";
      L.marker([latitude,longtitude]).addTo(map).bindPopup(description);

      var circle = L.circle([latitude,longtitude], {
        color: 'red',
        fillColor: '#f03',
        fillOpacity: 0.5,
        radius: 1000
      }).addTo(map)

    }
  }

  </script>
</body>

</html>
